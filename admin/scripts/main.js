(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(t){t.attach(".cortex-admin-blocks-page, .edit-php.post-type-acf-field-group",function(o,e){var a=t(".cortex-create-block-modal"),c=t(".cortex-update-block-modal"),n=function(o){o.preventDefault(),c.trigger("present",t(o.target).attr("href"))};e.on("click",".cortex-create-block-link",function(o){o.preventDefault(),a.trigger("present",t(o.target).attr("href"))}),e.on("click",".cortex-update-block-link",n),e.find(".wp-list-table a").each(function(o,e){var a=(e=t(e)).attr("href"),c=/post\.php\?post=(\d+)&action=edit/gim.exec(a);if(null!=c){var r=c[1];t.each(CORTEX.blocks,function(t,o){o.ID==r&&e.on("click",n)})}})}),t.attach(".cortex-create-block-modal, .cortex-update-block-modal",function(t,o){var e=o.find("iframe"),a=function(){var t=e.contents();if(t.find(".acf-btn.acf-publish").on("click",function(){o.toggleClass("cortex-modal-loading",!0)}),t.find("#message.notice.notice-success.updated").length)return location.reload(),void o.trigger("dismiss");o.toggleClass("cortex-modal-loading",!1)};o.on("present",function(t,c){e.on("load",a).attr("src",c),o.addClass("cortex-modal-loading")}),o.on("dismiss",function(){e.off("load",a).attr("src",""),o.addClass("cortex-modal-loading")})})}(jQuery);

},{}],2:[function(require,module,exports){
"use strict";jQuery.attach(".cortex-admin-settings-page",function(t,e){});

},{}],3:[function(require,module,exports){
"use strict";jQuery.attach(".cortex-modal",function(o,s){s.on("present",function(){s.toggleClass("cortex-modal-visible",!0)}),s.on("dismiss",function(){s.toggleClass("cortex-modal-visible",!1)}),s.on("click",".cortex-modal-close",function(){s.trigger("dismiss")})});

},{}],4:[function(require,module,exports){
"use strict";require("./vendors/dom-to-image.min"),require("./plugins/jquery-attach"),require("./components/cortex-admin-blocks-page"),require("./components/cortex-admin-settings-page"),require("./components/cortex-modal"),function(e){window.Cortex={generatePreview:function(t,a,o,r,i){window.addEventListener("message",function r(i){var s=i.data;if(s&&(s=JSON.parse(s)),"render_complete"==s.action&&s.target==o){var c=new Image;c.src=s.data,n.empty(),n.append(c),e.ajax({url:ajaxurl,method:"post",data:{action:"save_preview",id:t,post:a,hash:o,data:s.data,w:c.naturalWidth,h:c.naturalHeight}}),window.removeEventListener("message",r)}});var n=e('[data-hash="'+o+'"]'),s=e("<iframe></iframe>");s.css("width",1440),s.css("height",0),s.css("opacity",0),s.css("position","fixed"),s.css("pointer-events","none"),s.appendTo(document.body),r+="&mode=preview",s.attr("src",r).on("load",function(){console.log("render url",r);var e=s.contents();if(null!=e){var t=e.find("body"),a=t.find(":first"),i=t.find(":last"),n=t.get(0).scrollHeight;n+=parseFloat(a.css("margin-top"))||0,n+=parseFloat(i.css("margin-bottom"))||0,t.css("height",n),function(e,t){e.get(0).contentWindow.postMessage(JSON.stringify(t),"*")}(s,{action:"render_preview",target:o})}})}};e.attach("body.cortex-create-block-page",function(e,t){t.addClass("cortex-create-block-page-ready")}),e.attach("body.cortex-update-block-page",function(e,t){t.addClass("cortex-update-block-page-ready")}),e(document).ready(function(){[{mode:"ace/mode/twig",editor:"#cortex-block-editor",textarea:"#cortex-block"},{mode:"ace/mode/scss",editor:"#cortex-style-editor",textarea:"#cortex-style"},{mode:"ace/mode/javascript",editor:"#cortex-script-editor",textarea:"#cortex-script"}].forEach(function(t){var a=e(t.editor),o=e(t.textarea);if(0!=a.length){var r=function(){o.val(s.getSession().getValue())},i=!1,n=o.val(),s=ace.edit(a.get(0));s.setTheme("ace/theme/tomorrow_night"),s.getSession().setMode(t.mode),s.getSession().setValue(n),s.getSession().on("change",r);var c=a.attr("data-id"),d=a.attr("data-file"),l=a.attr("data-date"),g=e('<div class="cortex-reload"></div>');g.on("click",function(){i=!0,g.addClass("cortex-reload-reloading"),e.post(ajaxurl,{action:"get_block_file_data",id:c,file:d},function(t){e.post(ajaxurl,{action:"get_block_file_date",id:c,file:d},function(e){l=e,a.removeClass("invalid"),s.getSession().setValue(t),g.removeClass("cortex-reload-reloading"),g.detach(),i=!1})})}),setTimeout(function t(){e.post(ajaxurl,{action:"get_block_file_date",id:c,file:d},function(e){setTimeout(t,1e4),i||(parseInt(e)>parseInt(l)?(a.toggleClass("invalid",!0),a.append(g)):(a.toggleClass("invalid",!1),g.detach()))})},1e4),r()}})})}(jQuery);

},{"./components/cortex-admin-blocks-page":1,"./components/cortex-admin-settings-page":2,"./components/cortex-modal":3,"./plugins/jquery-attach":5,"./vendors/dom-to-image.min":6}],5:[function(require,module,exports){
"use strict";!function(t){var c=1,a=[];t.attach=function(t,c){var n={selector:t,callback:c};a.push(n)},t.attach.refresh=function(n){!function n(e){e.each(function(e,i){i=t(i),t.each(a,function(t,a){var n=a.selector,e=a.callback;n&&e&&i.is(n)&&(i.attr("data-attach-id",c++),e(t,i))}),n(i.children())})}(t(n||document.body))},t.detach=function(c){!function c(a){a.each(function(a,n){(n=t(n)).is("[data-attach-id]")&&n.trigger("detach"),c(n.children())})}(t(c||document.body))},t(document).ready(function(){t.attach.refresh()})}(jQuery);

},{}],6:[function(require,module,exports){
"use strict";!function(e){function t(e,t){return function(e){void 0===e.imagePlaceholder?s.impl.options.imagePlaceholder=l.imagePlaceholder:s.impl.options.imagePlaceholder=e.imagePlaceholder,void 0===e.cacheBust?s.impl.options.cacheBust=l.cacheBust:s.impl.options.cacheBust=e.cacheBust}(t=t||{}),Promise.resolve(e).then(function(e){return function e(t,n,r){function o(t,n,r){function o(t,n,r){var o=Promise.resolve();return n.forEach(function(n){o=o.then(function(){return e(n,r)}).then(function(e){e&&t.appendChild(e)})}),o}var u=t.childNodes;return 0===u.length?Promise.resolve(n):function o(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return function e(t,n,r){function o(t,n,r){function o(t,n,r){var o=Promise.resolve();return n.forEach(function(n){o=o.then(function(){return e(n,r)}).then(function(e){e&&t.appendChild(e)})}),o}var u=t.childNodes;return 0===u.length?Promise.resolve(n):o(n,i.asArray(u),r).then(function(){return n})}return r||!n||n(t)?Promise.resolve(t).then(function(e){return e instanceof HTMLCanvasElement?i.makeImage(e.toDataURL()):e.cloneNode(!1)}).then(function(e){return o(t,e,n)}).then(function(e){return function(e,t){return t instanceof Element?Promise.resolve().then(function(){!function(e,t){e.cssText?t.cssText=e.cssText:function(e,t){i.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}(e,t)}(window.getComputedStyle(e),t.style)}).then(function(){function n(n){var r=window.getComputedStyle(e,n),o=r.getPropertyValue("content");if(""!==o&&"none"!==o){var u=i.uid();t.className=t.className+" "+u;var c=document.createElement("style");c.appendChild(function(e,t,n){var r="."+e+":"+t,o=n.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(n):function(e){return i.asArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}).join("; ")+";"}(n);return document.createTextNode(r+"{"+o+"}")}(u,n,r)),t.appendChild(c)}}[":before",":after"].forEach(function(e){n(e)})}).then(function(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}).then(function(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}).then(function(){return t}):t}(t,e)}):Promise.resolve()}(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}(n,i.asArray(u),r).then(function(){return n})}return r||!n||n(t)?Promise.resolve(t).then(function(e){return e instanceof HTMLCanvasElement?i.makeImage(e.toDataURL()):e.cloneNode(!1)}).then(function(e){return o(t,e,n)}).then(function(e){return function(e,t){return t instanceof Element?Promise.resolve().then(function(){!function(e,t){e.cssText?t.cssText=e.cssText:function(e,t){i.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}(e,t)}(window.getComputedStyle(e),t.style)}).then(function(){function n(n){var r=window.getComputedStyle(e,n),o=r.getPropertyValue("content");if(""!==o&&"none"!==o){var u=i.uid();t.className=t.className+" "+u;var c=document.createElement("style");c.appendChild(function(e,t,n){var r="."+e+":"+t,o=n.cssText?function(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}(n):function(e){return i.asArray(e).map(function(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}).join("; ")+";"}(n);return document.createTextNode(r+"{"+o+"}")}(u,n,r)),t.appendChild(c)}}[":before",":after"].forEach(function(e){n(e)})}).then(function(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}).then(function(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}).then(function(){return t}):t}(t,e)}):Promise.resolve()}(e,t.filter,!0)}).then(r).then(o).then(function(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(n){e.style[n]=t.style[n]}),e}).then(function(n){return function(e,t,n){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(i.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+n+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}(n,t.width||i.width(e),t.height||i.height(e))})}function n(e,n){function r(e){var t=document.createElement("canvas");if(t.width=n.width||i.width(e),t.height=n.height||i.height(e),n.bgcolor){var r=t.getContext("2d");r.fillStyle=n.bgcolor,r.fillRect(0,0,t.width,t.height)}return t}return t(e,n).then(i.makeImage).then(i.delay(100)).then(function(t){var n=r(e);return n.getContext("2d").drawImage(t,0,0),n})}function r(e){return c.resolveAll().then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})}function o(e){return a.inlineAll(e).then(function(){return e})}var i=function(){function e(e){var t=/\.([^\.\/]*?)$/g.exec(e);return t?t[1]:""}function t(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}return{escape:function(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return function(){var e="application/font-woff",t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}()[n]||""},dataAsUrl:function(e,t){return"data:"+t+";base64,"+e},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):function(e){return new Promise(function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:"image/png"}))})}(e)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href},getAndEncode:function(e){var t=3e4;return s.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),new Promise(function(n){function r(e){console.error(e),n("")}var o,i=new XMLHttpRequest;if(i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)return void(o?n(o):r("cannot fetch resource: "+e+", status: "+i.status));var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)},t.readAsDataURL(i.response)}},i.ontimeout=function(){o?n(o):r("timeout of "+t+"ms occured while fetching resource: "+e)},i.responseType="blob",i.timeout=t,i.open("GET",e,!0),i.send(),s.impl.options.imagePlaceholder){var u=s.impl.options.imagePlaceholder.split(/,/);u&&u[1]&&(o=u[1])}})},uid:function(){var e=0;return function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++}}(),delay:function(e){return function(t){return new Promise(function(n){setTimeout(function(){n(t)},e)})}},asArray:function(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t},escapeXhtml:function(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src=e})},width:function(e){var n=t(e,"border-left-width"),r=t(e,"border-right-width");return e.scrollWidth+n+r},height:function(e){var n=t(e,"border-top-width"),r=t(e,"border-bottom-width");return e.scrollHeight+n+r}}}(),u=function(){function e(e){return-1!==e.search(r)}function t(e){for(var t,n=[];null!==(t=r.exec(e));)n.push(t[1]);return n.filter(function(e){return!i.isDataUrl(e)})}function n(e,t,n,r){return Promise.resolve(t).then(function(e){return n?i.resolveUrl(e,n):e}).then(r||i.getAndEncode).then(function(e){return i.dataAsUrl(e,i.mimeType(t))}).then(function(n){return e.replace(function(e){return new RegExp("(url\\(['\"]?)("+i.escape(e)+")(['\"]?\\))","g")}(t),"$1"+n+"$3")})}var r=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(r,o,i){return e(r)?Promise.resolve(r).then(t).then(function(e){var t=Promise.resolve(r);return e.forEach(function(e){t=t.then(function(t){return n(t,e,o,i)})}),t}):Promise.resolve(r)},shouldProcess:e,impl:{readUrls:t,inline:n}}}(),c=function(){function e(){function e(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return u.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}return Promise.resolve(i.asArray(document.styleSheets)).then(function(e){var t=[];return e.forEach(function(e){try{i.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t}).then(function(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return u.shouldProcess(e.style.getPropertyValue("src"))})}).then(function(t){return t.map(e)})}return{resolveAll:function(){return e(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})},impl:{readAll:e}}}(),a=function(){function e(e){return{inline:function(t){return i.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||i.getAndEncode).then(function(t){return i.dataAsUrl(t,i.mimeType(e.src))}).then(function(t){return new Promise(function(n,r){e.onload=n,e.onerror=r,e.src=t})})}}}return{inlineAll:function t(n){return n instanceof Element?function(e){var t=e.style.getPropertyValue("background");return t?u.inlineAll(t).then(function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))}).then(function(){return e}):Promise.resolve(e)}(n).then(function(){return n instanceof HTMLImageElement?e(n).inline():Promise.all(i.asArray(n.childNodes).map(function(e){return t(e)}))}):Promise.resolve(n)},impl:{newImage:e}}}(),l={imagePlaceholder:void 0,cacheBust:!1},s={toSvg:t,toPng:function(e,t){return n(e,t||{}).then(function(e){return e.toDataURL()})},toJpeg:function(e,t){return n(e,t=t||{}).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})},toBlob:function(e,t){return n(e,t||{}).then(i.canvasToBlob)},toPixelData:function(e,t){return n(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,i.width(e),i.height(e)).data})},impl:{fontFaces:c,images:a,util:i,inliner:u,options:{}}};"undefined"!=typeof module?module.exports=s:(void 0).domtoimage=s}();

},{}]},{},[4]);
